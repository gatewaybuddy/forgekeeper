version: "3.8"
services:
  triton:
    image: nvcr.io/nvidia/tritonserver:24.05-py3
    container_name: forgekeeper-triton
    command: ["tritonserver", "--model-repository=/models", "--model-control-mode=explicit", "--exit-on-error=false", "--strict-readiness=false"]
    ports:
      - "8000:8000"   # HTTP
      - "8001:8001"   # gRPC
      - "8002:8002"   # Metrics
    volumes:
      - ../../models:/models:ro
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: ["gpu"]
    restart: unless-stopped
