version: "3.9"

# Optional dev-time overrides for hot reload and fast iteration.
# Not auto-wired. Use with: docker compose -f docker-compose.yml -f docker-compose.dev.yml up --build

services:
  backend:
    # Mount live source and run the dev server
    working_dir: /app
    volumes:
      - ./backend:/app
      - /app/node_modules
    environment:
      NODE_ENV: development
    command: sh -c "npm install && npm run dev"

  frontend:
    # Run Vite dev server instead of nginx, with live source
    working_dir: /app
    volumes:
      - ./frontend:/app
      - /app/node_modules
    environment:
      NODE_ENV: development
      # BACKEND_URL still passed from base compose env_file
    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${FRONTEND_DEV_PORT:-5173}"
    ports:
      - "${FRONTEND_DEV_PORT:-5173}:5173"

  python:
    # Mount the Python package so changes are picked up without rebuild
    working_dir: /app
    volumes:
      - ./forgekeeper:/app/forgekeeper
      - ./requirements.txt:/app/requirements.txt:ro
    command: ["python", "-m", "forgekeeper.main"]

