$schema: "https://json-schema.org/draft/2020-12/schema"
title: Multi-Role Pipeline Contract
$comment: |
  Mirrors T1 deliverable in docs/plans/multi_role_pipeline.yaml.
  Validates role contracts that describe how autonomous roles collaborate.
type: object
required:
  - version
  - roles
properties:
  version:
    type: integer
    minimum: 1
    description: Schema version for validation tooling.
  updated_at:
    type: string
    format: date
    description: Date the contract set was last reviewed.
  roles:
    type: array
    minItems: 1
    items:
      type: object
      required:
        - id
        - name
        - summary
        - responsibilities
        - inputs
        - outputs
        - handoffs
        - service_accounts
        - tools
        - decision_rights
        - sla
      properties:
        id:
          type: string
          pattern: "^[A-Z][A-Z0-9_-]+$"
          description: Short unique identifier (e.g., PLAN, EVAL).
        name:
          type: string
          description: Human-friendly role name.
        summary:
          type: string
          description: One sentence describing the role objective.
        responsibilities:
          type: array
          minItems: 1
          items:
            type: string
          description: Key responsibilities for the role.
        inputs:
          type: array
          items:
            type: object
            required:
              - source
              - artifacts
            properties:
              source:
                type: string
                description: Upstream role or system providing inputs.
              artifacts:
                type: array
                minItems: 1
                items:
                  type: string
                description: Artifacts received from the source.
          description: Structured list of required inputs.
        outputs:
          type: array
          items:
            type: object
            required:
              - artifact
              - consumer
            properties:
              artifact:
                type: string
              consumer:
                type: string
              notes:
                type: string
                description: Optional metadata such as retention or sensitivity.
          description: Artifacts produced for other roles or systems.
        handoffs:
          type: array
          items:
            type: object
            required:
              - to
              - success_criteria
              - channel
            properties:
              to:
                type: string
                description: Downstream role receiving the handoff.
              success_criteria:
                type: string
                description: Observable outcome that signals completion.
              channel:
                type: string
                description: Communication medium (e.g., workflow queue, Slack).
          description: Expected handoffs and success criteria.
        service_accounts:
          type: array
          items:
            type: object
            required:
              - name
              - permissions
            properties:
              name:
                type: string
              environment:
                type: string
              permissions:
                type: array
                minItems: 1
                items:
                  type: string
          description: Least-privilege accounts provisioned for the role.
        tools:
          type: array
          items:
            type: object
            required:
              - name
              - allowlist
            properties:
              name:
                type: string
              allowlist:
                type: array
                items:
                  type: string
              audit_log:
                type: string
                description: Path or table for telemetry emitted by the tool.
          description: Tooling access and guardrails.
        decision_rights:
          type: array
          items:
            type: string
          description: Decisions the role can make without escalations.
        sla:
          type: object
          required:
            - response_minutes
            - resolution_minutes
          properties:
            response_minutes:
              type: integer
              minimum: 1
            resolution_minutes:
              type: integer
              minimum: 1
            coverage_hours:
              type: string
              description: Coverage window (e.g., 24x5, 16x7).
        metrics:
          type: array
          items:
            type: string
          description: Optional metrics tracked for the role.
        escalation:
          type: object
          properties:
            contact:
              type: string
            policy:
              type: string
          description: Escalation policy reference.
additionalProperties: false
